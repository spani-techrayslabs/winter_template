(()=>{"use strict";var e={114(e,t,r){r.d(t,{M:()=>n});var o=r(733),i=r(670);class n{initialize(){try{this.setupEventHandlers(),o.xI.log("Adserver initialized")}catch(t){let e={code:i.O4.ADSERVER_INIT_ERROR,severity:i.MU.ERROR,message:"Error initializing adserver manager",payload:{error:t instanceof Error?t.message:String(t)}};o.Vy.logScriptError(e)}}constructor(e){this.config=e,this.kvModifier=e.kvModifier||""}}},949(e,t,r){r.r(t),r.d(t,{GamAdserverManager:()=>d});var o=r(114),i=r(944),n=r(396),a=r(581),s=r(733),l=r(670);class d extends o.M{initialize(){try{if(!window.googletag||!googletag.cmd)throw Error("GPT API not available");super.initialize()}catch(e){s.Vy.logScriptError({code:l.O4.GPT_API_NOT_AVAILABLE,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}setupEventHandlers(){window.googletag?googletag.cmd.push(()=>{googletag.pubads().addEventListener("slotAdded",e=>{this.config.pbNamespace.que.push(()=>{let t=e.slot,r=i.A.getGamQueue();r.filter(e=>t&&(t.getAdUnitPath()===e.adUnitCode||t.getSlotElementId()===e.adUnitCode)).forEach(e=>{if(e.cmd()){let t=r.findIndex(t=>t.id===e.id);t>-1&&r.splice(t,1)}})})})}):s.Vy.logScriptError({code:l.O4.GPT_API_NOT_AVAILABLE,severity:l.MU.ERROR,payload:{error:"GPT API not available: window.googletag is undefined"}})}setKeyValues(e,t,r){googletag.cmd.push(()=>{try{let o=r.auctionId;this.clearKeyValues(e,o,this.config);let l=this.appendModifierToKeyValues(t,this.kvModifier),d=a.Vn.getGptSlotAdUnit(e);if(d)return void this.setTargeting(d,l);let c={id:(0,n.lk)(),auctionId:o,adUnitCode:e,cmd:()=>{let t=a.Vn.getGptSlotAdUnit(e);return!!t&&(this.setTargeting(t,l),!0)},error:()=>(s.xI.error(`Error setting key-values for adUnitCode: ${e}`,{auctionId:o,updatedKeyValues:l}),!1),logged:!1};i.A.addToGamQueue(c)}catch(e){s.Vy.logScriptError({code:l.O4.SET_KEY_VALUES_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}})}setTargeting(e,t){if(!e)throw Error("Invalid googletag slot");s.xI.log(`Setting GAM KVs for: ${e.getAdUnitPath()}`,{slot:e,keyValues:t}),Object.entries(t).forEach(([t,r])=>{e.setTargeting(t,r)})}clearKeyValues(e,t,r){let o=a.Vn.getGptSlotAdUnit(e);if(o)try{let i=o.getTargetingKeys().filter(e=>[r.pubxSplitKey,r.pubxGamKey,r.pubxOptimizedKey,r.pubxMvKey,r.pubxFloorKey,r.pubxFloorMvKey].includes(e));i.forEach(e=>{o.clearTargeting(e)}),s.xI.log("Clearing exiting GAM KVs",{auctionId:t,adUnitCode:e,keys:i})}catch(e){s.Vy.logScriptError({code:l.O4.GAM_CLEAR_KEY_VALUES_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}constructor(...e){super(...e),this.appendModifierToKeyValues=(e,t)=>{if(!t||""===t)return e;let r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){var o;o=r[t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o})}return e}({},e);return s.xI.log("Appending KV modifier to key values",{keyVals:e,valueModifier:t,updatedKeyVals:r}),Object.entries(r).forEach(([e,o])=>{r[e]=`${o}-${t}`}),r}}}},878(e,t,r){r.r(t),r.d(t,{GamLivewrappedAdserverManager:()=>s});var o=r(114),i=r(944),n=r(733),a=r(670);class s extends o.M{initialize(){try{if(!window.googletag||!googletag.cmd)throw Error("GPT API not available");super.initialize()}catch(e){n.Vy.logScriptError({code:a.O4.GPT_API_NOT_AVAILABLE,severity:a.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}setupEventHandlers(){window.googletag?googletag.cmd.push(()=>{googletag.pubads().addEventListener("slotAdded",e=>{this.config.pbNamespace.que.push(()=>{let t=e.slot,r=i.A.getGamQueue();r.filter(e=>t&&(t.getAdUnitPath()===e.adUnitCode||t.getSlotElementId()===e.adUnitCode)).forEach(e=>{if(e.cmd()){let t=r.findIndex(t=>t.id===e.id);t>-1&&r.splice(t,1)}})})})}):n.Vy.logScriptError({code:a.O4.GPT_API_NOT_AVAILABLE,severity:a.MU.ERROR,payload:{error:"GPT API not available: window.googletag is undefined"}})}setKeyValues(e,t,r){let o=r.auctionId;googletag.cmd.push(()=>{try{let r=this.appendModifierToKeyValues(t,this.kvModifier);if(void 0===window.lwhbim||void 0===window.lwhbim.adServerKeywordsAdUnit||"function"!=typeof window.lwhbim.adServerKeywordsAdUnit)throw Error("lwhbim API not available");Object.entries(r).forEach(([t,r])=>{window.lwhbim.adServerKeywordsAdUnit(e,{[t]:r}),n.xI.log("Setting KVs in lwhbim API",{auctionId:o,adUnitCode:e,key:t,value:r})})}catch(e){n.Vy.logScriptError({code:a.O4.IMPROVEMEDIA_API_NOT_FOUND,severity:a.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}})}constructor(...e){super(...e),this.appendModifierToKeyValues=(e,t)=>{if(!t||""===t)return e;let r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){var o;o=r[t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o})}return e}({},e);return n.xI.log("Appending KV modifier to key values",{keyVals:e,valueModifier:t,updatedKeyVals:r}),Object.entries(r).forEach(([e,o])=>{r[e]=`${o}-${t}`}),r}}}},223(e,t,r){r.r(t),r.d(t,{NullAdserverManager:()=>n});var o=r(114),i=r(733);class n extends o.M{initialize(){}setupEventHandlers(){}setKeyValues(e,t,r){Object.entries(t).forEach(([t,o])=>{i.xI.log("NullAdServer received KVs",{auctionId:r.auctionId,adUnitCode:e,key:t,value:o}),i.Vy.logAuctionEvent({type:"gamTargeting",data:{adUnitCode:e,[t]:o}},r)})}}},286(e,t,r){r.d(t,{A:()=>o});class o{constructor(e){this.config=e}}},436(e,t,r){r.r(t),r.d(t,{CustomMagniteBilling:()=>l});var o=r(286),i=r(733),n=r(396),a=r(998),s=r(670);class l extends o.A{generateBillableEvent(e,t){return{vendor:"pubxai",auctionId:e.auctionId,transactionId:t||(0,n.lk)(),billingId:(0,n.lk)(),type:"impression"}}raiseBillableEvent(e,t){try{this.config.pbNamespace.rp.billableEvent(e),i.xI.info("pubx: billable event raised for adUnit:",t,e)}catch(e){i.Vy.logScriptError({code:s.O4.BILLABLE_EVENT_ERROR,severity:s.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}processBillingForAuction(e){e.adUnits.forEach(t=>{if(!(0,a.arePubxFloorsSet)(t))return;let r=this.generateBillableEvent(e,t.transactionId);this.raiseBillableEvent(r,t.code)})}}},151(e,t,r){r.r(t),r.d(t,{NullBilling:()=>i});var o=r(286);class i extends o.A{generateBillableEvent(e,t){return{}}raiseBillableEvent(e,t){}processBillingForAuction(e){}}},322(e,t,r){r.d(t,{o:()=>a});var o=r(309),i=r(748),n=r(670);class a{init(){try{o.xI.log("Initializing floor manager"),this.floorsConfig=this.getFloorsConfig(),o.xI.log("Floor manager initialized with config :",this.floorsConfig),this.floorsConfig=this.applyFloorMin(this.floorsConfig);let e=this.setFloorsConfig(this.floorsConfig);return o.xI.log("Floor manager setFloorsConfig result :",e),e}catch(t){let e={severity:n.MU.FATAL,code:n.O4.FLOORS_INIT_ERROR,payload:{error:t instanceof Error?t.message:String(t)}};return o.Vy.logScriptError(e),{success:!1,message:t instanceof Error?t.message:String(t)}}}applyFloorMin(e){var t,r;if(!(null==e||null==(r=e.floors)||null==(t=r.data)?void 0:t.values)||"number"!=typeof e.floors.floorMin)return e;let{floors:i}=e,{data:n}=i,a=i.floorMin;return o.xI.info("Applying Floors Min",a),Object.keys(n.values).forEach(e=>{let t=n.values[e];void 0!==t&&(n.values[e]=Math.max(t,a))}),e}isValidFloorsProvider(e){return!!e&&[i.Kq.PUBX,i.Kq.PUBX_OFF,i.Kq.PUBX_TIMEOUT].includes(e)}isPriceFloorsModuleInstalled(){return!!this.config.pbNamespace&&!!this.config.pbNamespace.installedModules&&this.config.pbNamespace.installedModules.includes("priceFloors")}getExistingFloorsConfig(){return this.config.pbNamespace&&this.config.pbNamespace.getConfig?this.config.pbNamespace.getConfig("floors"):null}constructor(e){this.floorsConfig=null,this.floorFetchStatus=i.hW.PENDING,this.config=e}}},953(e,t,r){r.r(t),r.d(t,{RefreshOnlyFloorManager:()=>l});var o=r(309),i=r(670),n=r(685),a=r(322),s=r(748);class l extends a.o{getFloorsConfig(){return(0,n.GT)(this.config)}setFloorsConfig(e){if(!o.fN.isPubxLoaded())return{success:!1,message:"Pubx not loaded"};let t=this.config;if(!e)return{success:!1,message:"No floors configuration available"};try{return t.pbNamespace.que.push(()=>{try{var r;if(!this.isPriceFloorsModuleInstalled())throw Error(i.rZ[i.O4.PRICE_FLOORS_NOT_FOUND].message);let n=this.getExistingFloorsConfig();(null==n||null==(r=n.data)?void 0:r.floorProvider)&&!this.isValidFloorsProvider(n.data.floorProvider)&&o.Vy.logPageError({code:i.O4.NON_PUBX_FLOORS_FOUND,payload:{existingFloors:n}}),t.pbNamespace.setConfig(e),o.fN.setGlobalFloorsConfig(e),o.fN.setFloorFetchStatus(s.hW.SUCCESS),this.floorFetchStatus=s.hW.SUCCESS,o.xI.log("Setting Floors Config",e)}catch(n){let e=n instanceof Error?n.message:String(n),t=(0,i.O1)(e),r={code:t.code,severity:t.severity,payload:{error:e}};o.Vy.logScriptError(r)}}),{success:!0,message:"Floors configuration queued for setup",data:e}}catch(t){let e={code:i.O4.FLOORS_INIT_ERROR,severity:i.MU.ERROR,payload:{error:t instanceof Error?t.message:String(t)}};return o.Vy.logScriptError(e),{success:!1,message:t instanceof Error?t.message:String(t)}}}init(){try{return o.xI.log("Initializing floor manager"),this.floorsConfig=this.getFloorsConfig(),o.xI.log("Refresh Only Floor manager initialized "),this.floorsConfig=this.applyFloorMin(this.floorsConfig),o.fN.setGlobalFloorsConfig(this.floorsConfig),{success:!0,message:"Refresh Only Floor manager initialized"}}catch(t){let e={severity:i.MU.FATAL,code:i.O4.FLOORS_INIT_ERROR,payload:{error:t instanceof Error?t.message:String(t)}};return o.Vy.logScriptError(e),{success:!1,message:t instanceof Error?t.message:String(t)}}}}},991(e,t,r){r.d(t,{k6:()=>a,Kq:()=>o.Kq});var o=r(748);r(322);var i=r(733);function n(e,t,r,o,i,n,a){try{var s=e[n](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(o,i)}class a{static createFloorManager(e){var t;return(t=function*(){i.xI.log("FloorManagerType","refreshOnly");if(1&&1&&1){let{RefreshOnlyFloorManager:t}=yield Promise.resolve().then(r.bind(r,953));return new t(e)}},function(){var e=this,r=arguments;return new Promise(function(o,i){var a=t.apply(e,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)})})()}}},748(e,t,r){r.d(t,{Kq:()=>l,Xx:()=>s,hW:()=>a});var o,i,n,a=((o={}).PENDING="PENDING",o.SKIPPED="SKIPPED",o.IN_PROGRESS="IN_PROGRESS",o.SUCCESS="SUCCESS",o.TIMEOUT="TIMEOUT",o.ERROR="ERROR",o),s=((i={}).SUCCESS="success",i.TIMEOUT="timeout",i.ERROR="error",i),l=((n={}).PUBX="PubxFloorProvider",n.PUBX_OFF="pbxai",n.PUBX_TIMEOUT="pbxai_z",n)},522(e,t,r){r.d(t,{x:()=>o});class o{static init(){let e=new URLSearchParams(window.location.search);this.shouldLog=e.has("pubx_debug"),this.info("Pubx DebugConsole initialized")}static log(e,...t){this.shouldLog&&console.info("%cPubx.ai","background-color:rgb(0, 192, 3); color: white; border-radius: 3px; padding: 1px 4px","LOG:",e,...t.filter(e=>void 0!==e))}static error(e,...t){t=t.filter(e=>void 0!==e),this.shouldLog&&console.error("%cPubx.ai","background-color:rgb(252, 3, 3); color: white; border-radius: 3px; padding: 1px 4px","ERROR:",e,...t)}static warn(e,...t){this.shouldLog&&console.warn("%cPubx.ai","background-color:rgb(181, 134, 15); color: white; border-radius: 3px; padding: 1px 4px","WARN:",e,...t.filter(e=>void 0!==e))}static info(e,...t){this.shouldLog&&console.info("%cPubx.ai","background-color:rgb(3, 181, 252); color: white; border-radius: 3px; padding: 1px 4px","INFO:",e,...t.filter(e=>void 0!==e))}}o.shouldLog=!1},946(e,t,r){r.d(t,{V:()=>p});var o=r(522),i=r(944),n=r(713),a=r(288),s=r(670),l=r(685),d=r(998),c=r(396);function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){var o;o=r[t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o})}return e}function g(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}class p{static init(e){var t,r,o;this.config=e,this.enableLogs=i.A.getFromPubx(n.I.PUBX_LOGS_ENABLED);let s=null!=(t=null==(r=(o=e.pbNamespace).getEvents)?void 0:r.call(o))?t:[];this.missedAuctionCount=s.filter(e=>e.eventType===a.gl.AUCTION_INIT).length,this.hasBrowserSupport()&&this.registerVisibilityChangeEvent()}static registerVisibilityChangeEvent(){document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.flushLogs()})}static hasBrowserSupport(){return null!==this.browserSupported||(this.browserSupported="u">typeof navigator&&"function"==typeof navigator.sendBeacon&&"u">typeof document&&"string"==typeof document.visibilityState),this.browserSupported}static splitIntoChunks(e,t){let r=[],o=[],i=0;for(let n of e){let e=JSON.stringify([n]).length;i+e>t?(r.push(o),o=[n],i=e):(o.push(n),i+=e)}return o.length>0&&r.push(o),r}static pushLogs(e,t){0!==e.length&&this.splitIntoChunks(e,65536).forEach(e=>{let r=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(t,r)})}static logErrorToConsole(e){var t;let{code:r,adUnitCode:i,payload:n}=e,a=(null==(t=s.rZ[r])?void 0:t.message)||"Unknown error";o.x.error(a,i,n)}static logWarningToConsole(e){var t;let{code:r,adUnitCode:i,payload:n}=e,a=(null==(t=s.rZ[r])?void 0:t.message)||"Unknown error";o.x.warn(a,i,n)}static logAuctionError(e,t){this.logWarningToConsole(e),this.hasBrowserSupport()&&this.enableLogs&&this.aucErrorLogs.push(this.transformAucErrorData(e,t))}static logPageError(e){this.logErrorToConsole(e),this.hasBrowserSupport()&&this.enableLogs&&this.pageErrorLogs.push(this.transformPageErrorData(e))}static logScriptError(e){this.logErrorToConsole(e),this.hasBrowserSupport()&&this.enableLogs&&this.scriptErrorLogs.push(u({type:"script",errorData:(0,s.fC)(e)},this.createBaseGenericLog()))}static logAuctionEvent(e,t,r){var i;if(!this.hasBrowserSupport()||!this.enableLogs)return;let n=this.aucEventLogs.find(e=>e.auctionId===t.auctionId),a=null!=(i=null!=r?r:this.missedAuctionCount)?i:0;n||(n=this.createAucEventLog(t,a),this.aucEventLogs.push(n)),this.updateAucEventLog(n,e),o.x.info("Updated auction event logs",this.aucEventLogs)}static updateAucEventLog(e,t){if("pbBid"===t.type)return void e.pbBidData.push(t.data);let r=t.data,o=e.gamTargetingData.find(e=>e.adUnitCode===r.adUnitCode);o?Object.assign(o,r):e.gamTargetingData.push(r)}static addQueuedAucErrors(){i.A.getGamQueue().filter(e=>!e.logged).forEach(e=>{e.error(),e.logged=!0})}static createBaseGenericLog(){return{isPubxEnabled:i.A.isPubxLoaded(),pubxId:this.config.pubxId,tagInfo:(0,c.to)(this.config),pageInfo:(0,c.cv)(this.pageId),timesince:Date.now()-i.A.getFromPubx(n.I.LOAD_TIMESTAMP),timestamp:Date.now()}}static transformAucErrorData(e,t){let r=this.config.pbNamespace,o=this.filterAuctionDataByAdUnitCode(t,e.adUnitCode),{auctionId:i}=o;return u({previousAuctionCount:(0,l.yN)(r,i),auctionId:i,auctionInfo:this.createErrorLogAuctionInfo(o),modelVersion:(0,d.getFloorModelVersionForLogs)(t)},this.transformPageErrorData(e))}static filterAuctionDataByAdUnitCode(e,t){if(!t)return e;let{adUnits:r,bidderRequests:o,bidsReceived:i,bidsRejected:n}=e;return g(u({},function(e,t){if(null==e)return{};var r,o,i,n={};if("u">typeof Reflect&&Reflect.ownKeys){for(i=0,r=Reflect.ownKeys(e);i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o]);return n}if(n=function(e,t){if(null==e)return{};var r,o,i={},n=Object.getOwnPropertyNames(e);for(o=0;o<n.length;o++)r=n[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r]);return i}(e,t),Object.getOwnPropertySymbols)for(i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o]);return n}(e,["adUnits","bidderRequests","bidsReceived","bidsRejected"])),{adUnits:r.filter(e=>e.code===t),bidderRequests:o.map(e=>g(u({},e),{bids:e.bids.filter(e=>e.adUnitCode===t)})),bidsReceived:i.filter(e=>e.adUnitCode===t),bidsRejected:n?n.filter(e=>e.adUnitCode===t):void 0})}static createErrorLogAuctionInfo(e){let{adUnits:t,bidderRequests:r,bidsReceived:o,bidsRejected:i}=e;return{adUnits:t.map(({code:e,mediaTypes:t})=>({code:e,mediaTypes:Object.keys(t)})),bidderRequestsCount:r.length,bidsReceived:o.map(e=>({adUnitCode:e.adUnitCode,adserverTargeting:e.adserverTargeting?{hb_pb:e.adserverTargeting.hb_pb}:void 0,cpm:e.cpm,currency:e.currency,originalCpm:e.originalCpm,originalCurrency:e.originalCurrency,floorData:e.floorData?{floorValue:e.floorData.floorValue}:void 0})),bidsRejected:i?i.map(e=>({adUnitCode:e.adUnitCode,adserverTargeting:e.adserverTargeting?{hb_pb:e.adserverTargeting.hb_pb}:void 0,cpm:e.cpm,currency:e.currency,originalCpm:e.originalCpm,originalCurrency:e.originalCurrency,floorData:e.floorData?{floorValue:e.floorData.floorValue}:void 0})):void 0}}static transformPageErrorData(e){return u({type:"error",errorData:(0,s.fC)(e)},this.createBaseGenericLog())}static createAucEventLog(e,t){let r=this.config.pbNamespace,{auctionId:o,adUnits:a,bidsReceived:s,bidsRejected:c,bidderRequests:g}=e;return u({type:"event",missedAuctionCount:t,auctionId:o,auctionInfo:{adUnitCount:a.length,bidCount:s.length+(c?c.length:0),bidders:[...new Set(g.map(({bidderCode:e})=>e))]},pbBidData:[],gamTargetingData:[],loadedBeforePb:i.A.getFromPubx(n.I.LOADED_BEFORE_PB),floorProvider:(0,l.oo)(r),previousAuctionCount:(0,l.yN)(r,o),modelVersion:(0,d.getFloorModelVersionForLogs)(e)},this.createBaseGenericLog())}static flushLogs(){if(!this.hasBrowserSupport())return;this.addQueuedAucErrors();let e=[...this.aucErrorLogs,...this.pageErrorLogs,...this.aucEventLogs,...this.scriptErrorLogs];this.pushLogs(e,"https://analytics.pbxai.com"),this.aucErrorLogs.length=0,this.pageErrorLogs.length=0,this.aucEventLogs.length=0,this.scriptErrorLogs.length=0}}p.aucErrorLogs=[],p.pageErrorLogs=[],p.aucEventLogs=[],p.scriptErrorLogs=[],p.pageId=i.A.getFromPubx(n.I.PAGE_ID),p.enableLogs=!1,p.browserSupported=null,p.missedAuctionCount=null},733(e,t,r){r.d(t,{xI:()=>i.x,Vy:()=>o.V,YT:()=>g});var o=r(946),i=r(522),n=r(288),a=r(670),s=r(581),l=r(396),d=r(713),c=r(309);function u(e,t,r,o,i,n,a){try{var s=e[n](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(o,i)}class g{static init(e){this.config=e,this.initTelemetryCollection()}static initTelemetryCollection(){n.QG.push(()=>{this.startPriceFloorsTelemetryCollection(),n.QG.on(n.gl.AUCTION_END,this.triggerTelemetryCollection)})}static startPriceFloorsTelemetryCollection(){this.config.pbNamespace.getEvents().filter(e=>e.eventType===n.gl.AUCTION_DEBUG).map(e=>e.args).filter(this.isPriceFloorsError).forEach(e=>this.handlePriceFloorsError(e.arguments)),n.QG.on(n.gl.AUCTION_DEBUG,e=>{this.isPriceFloorsError(e)&&this.handlePriceFloorsError(e.arguments)})}static isPriceFloorsError(e){return e.type===n.J2.ERROR&&e.arguments.length>0&&e.arguments[0].includes("Price Floors")}static handlePriceFloorsError(e){let t=e[0],r="";if(e.length>1)try{r=JSON.stringify(e[1])}catch(t){r=e[1]}o.V.logPageError({code:a.O4.FLOORS_RESPONSE_INVALID,payload:{error:t,message:r}})}static isTimeToCall(){return s.Sp.getStorageItem("lastCallDate")!==new Date().toLocaleDateString()}static getAdUnitAndBidders(e){try{let t=e.adUnits||[],r=new Set,o=[];return t.forEach(e=>{let t=Object.keys(e.mediaTypes||{}),i=this.extractAdUnitSizes(e),n=this.getGamSlotId(e.code);o.push({code:e.code,sizes:i,gamSlot:n,media_type:t}),e.bids.forEach(e=>r.add(e.bidder))}),[{adUnits:o,bidders:Array.from(r)},null]}catch(e){return[{adUnits:[],bidders:[]},`Error in getAdUnitAndBidders: ${e.message}`]}}static extractAdUnitSizes(e){return e.mediaTypes.banner?e.mediaTypes.banner.sizes.map(e=>e.join("x")):[]}static getGamSlotId(e){let t=s.Vn.getGptSlotAdUnit(e);return t?t.getAdUnitPath()===e?t.getSlotElementId():t.getSlotElementId()===e?t.getAdUnitPath():"":""}static getPubxModuleStatus(){try{let e=this.config.pbNamespace.installedModules||[];return[{PubxaiAA:e.includes("pubxaiAnalyticsAdapter"),PriceFloors:e.includes("priceFloors"),PubxaiRTD:e.includes("pubxaiRtdProvider")},null]}catch(e){return[{},`Error in getPubxModuleStatus: ${e.message}`]}}static collectTelemetry(e){let t=[],r=this.config.pbNamespace,[o,i]=this.getAdUnitAndBidders(e);i&&t.push(i);let[n,a]=this.getPubxModuleStatus();a&&t.push(a);let s=c.fN.getFromPubx(d.I.PAGE_ID);return{pubx_id:this.config.pubxId,pbjs_version:r.version||"",installed_modules:r.installedModules.filter(e=>!e.includes("BidAdapter"))||[],ad_units:o.adUnits,bidders:o.bidders,pubx_modules_status:n,errors:t.length>0?t:null,timestamp:new Date().toISOString(),page_info:(0,l.cv)(s)}}static sendTelemetryData(e){var t;return(t=function*(){try{if(navigator.sendBeacon("https://analytics.pbxai.com/telemetry",new Blob([JSON.stringify(e)],{type:"application/json"})))return s.Sp.setStorageItem("lastCallDate",new Date().toLocaleDateString()),i.x.log("Telemetry data sent successfully using sendBeacon",e),!0;return i.x.log("Telemetry API call failed using sendBeacon"),!1}catch(e){return i.x.error("Telemetry API call failed due to an error:",e),!1}},function(){var e=this,r=arguments;return new Promise(function(o,i){var n=t.apply(e,r);function a(e){u(n,o,i,a,s,"next",e)}function s(e){u(n,o,i,a,s,"throw",e)}a(void 0)})})()}static triggerTelemetryCollection(e){if(100*Math.random()>=100/(this.config.samplingRate||1)/100||!this.isTimeToCall())return;i.x.log("Telemetry Triggered");let t=this.collectTelemetry(e);this.sendTelemetryData(t)}}},684(e,t,r){r.r(t),r.d(t,{Pmac:()=>p});var o=r(944),i=r(713),n=r(733),a=r(670),s=r(998),l=r(396),d=r(512),c=r(685);function u(e,t,r,o,i,n,a){try{var s=e[n](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(o,i)}function g(e){return function(){var t=this,r=arguments;return new Promise(function(o,i){var n=e.apply(t,r);function a(e){u(n,o,i,a,s,"next",e)}function s(e){u(n,o,i,a,s,"throw",e)}a(void 0)})}}class p{triggerPmac(){return g(function*(){let e=this.auctionData;for(let t of e.adUnits)try{if(!(0,s.arePubxFloorsSet)(t))return;let r=t.code,o=e.auctionId,{bidCpmValue:i,adUnitStatus:n}=(0,c.sZ)(t,e,this.config),a=(0,s.getFloorModelVersion)(t),l=(0,s.getFloorMultiplier)(a,this.config),d=(0,s.getDecayRateFromModelVersion)(a,this.config);yield this.trigger(o,r,i,n,l,d)}catch(e){n.xI.error("Error in PMAC trigger:",e),n.Vy.logScriptError({code:a.O4.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE,severity:a.MU.ERROR,adUnitCode:t.code,payload:{error:e instanceof Error?e.message:String(e)}})}}).call(this)}trigger(e,t,r,s,l,d){return g(function*(){if(null===d)return void n.xI.info("Decay rate not found. PMAC Turned off");try{yield this.loadFloorRules(),n.xI.info("Triggering pmac"),this.storeCpmInHistory(e,t,r,s),this.assignDecayRate(t,d);let a=o.A.getFromPubx(i.I.NEXTFLOORS_CONFIG);if(void 0===a)throw Error("__nextfloorsConfig__ undefined. Skip updating floors config");this.updateAndSetFloorsConfig(l,a,this.floorMin)}catch(e){n.xI.error("Error in PMAC trigger:",e),n.Vy.logScriptError({code:a.O4.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE,severity:a.MU.ERROR,adUnitCode:t,payload:{error:e}})}}).call(this)}updateAndSetFloorsConfig(e,t,r=null){googletag.cmd.push(()=>{this.updateFloorsConfig(e,r),this.setFloorsConfig(()=>t)})}loadFloorRules(){return g(function*(){return null!==this.floorRulesPromise||(this.floorRulesPromise=this.fetchFloorRulesCustomAzerion(this.config)),this.floorRulesPromise}).call(this)}fetchFloorRulesCustomAzerion(e){return g(function*(){try{let t=e.pbNamespace.getConfig("floors");n.xI.log("PMAC Received floor rules",t),o.A.setToPubx(i.I.NEXTFLOORS_CONFIG,{floors:t})}catch(e){throw n.xI.error("Error in PMAC fetchFloorRulesCustomAzerion",e),e}})()}fetchFloorRulesCustomMagnite(e){return g(function*(){try{let t=yield fetch(e.floorFetchUrl),r=yield t.json();n.xI.log("PMAC Received floor rules",r),(0,s.constructStaticFloorsConfigFromGlobal)(r,e.pbNamespace)}catch(r){let t=(0,s.getDefaultFloorRulesData)(e);n.xI.log("PMAC Default floor rules",t),(0,s.constructStaticFloorsConfigFromGlobal)(t,e.pbNamespace)}})()}fetchFloorRules(e){return g(function*(){try{n.xI.log("Fetching standard floor rules");let t=yield fetch(e.floorFetchUrl),r=yield t.json();n.xI.log("PMAC Received floor rules",r),(0,s.constructStaticFloorsConfig)(r)}catch(r){let t=(0,s.getDefaultFloorRulesData)(e);n.xI.log("PMAC Default floor rules",t),(0,s.constructStaticFloorsConfig)(t)}})()}storeCpmInHistory(e,t,r,a){n.xI.log(`pubx: Storing CPM history for ${t}: ${r}`);let s=o.A.getFromPubx(i.I.PMAC_CPM_HISTORY);void 0===s[t]&&(s[t]={history:[],decayRate:void 0});let l={auctionId:e,cpm:r,adUnitStatus:a};s[t].history.push(l),n.xI.log("Updated Pmac history",t,l)}assignDecayRate(e,t){n.xI.info(`Assigning decay rate for ${e}: ${t}`);let r=o.A.getFromPubx(i.I.PMAC_CPM_HISTORY);r[e]||(n.xI.warn(`No data found for ${e} in PMAC history. Assigning default values`),r[e]={history:[],decayRate:void 0}),r[e].decayRate=t}updateFloorsConfig(e,t=null){n.xI.info(`Pmac: Updating floors config with multiplier: ${e}`);let r=Object.keys(o.A.getFromPubx(i.I.PMAC_CPM_HISTORY));"PB_GAM_CUSTOM_AY"===window.__pubx__.variant?r.forEach(r=>{this.shouldUpdateFloorsConfigAdUnit(r)&&this.updateFloorsConfigAdUnit(r,void 0,this.predictFloor(r,e,t))}):(0,d.getGptSlotsWithAdUnitCodes)(r).forEach(({adUnitCode:r,slot:o})=>{this.shouldUpdateFloorsConfigAdUnit(r)&&this.updateFloorsConfigAdUnit(r,o,this.predictFloor(r,e,t))})}predictFloor(e,t,r=null){let{decayRate:n,history:a}=o.A.getFromPubx(i.I.PMAC_CPM_HISTORY)[e];if(void 0===n||0===a.length)throw Error(`Missing decay rate or history for adUnit: ${e}`);let[s,d]=[a[0].cpm,a.length],c=this.calculateNextCpm(s,n,d)*t;return null!==r&&(c=Math.max(c,r)),c<.01?.01:parseFloat(c.toFixed(l.b2))}calculateNextCpm(e,t,r){return(e=0===e?.01:e)*Math.exp(t*r)}updateFloorsConfigAdUnit(e,t,r){let l,d=o.A.getFromPubx(i.I.NEXTFLOORS_CONFIG);if(void 0===d)throw Error("__nextfloorsConfig__ undefined. Skip updating adUnit floors config");let{floors:{data:{values:c,schema:u}}}=d;void 0===(l=t?(0,s.getFloorRuleKey)(t,c,u):(0,s.getFloorRuleKeyByAdUnitCode)(e,c,u))?n.Vy.logAuctionError({code:a.O4.MISSING_ADUNIT_FLOOR_RESPONSE,adUnitCode:e,payload:{error:a.rZ[a.O4.MISSING_ADUNIT_FLOOR_RESPONSE].message}},this.auctionData):(c[l]=r,o.A.setToPubx(i.I.NEXTFLOORS_CONFIG,d))}getPmacAdUnitHistory(e){let t=o.A.getFromPubx(i.I.PMAC_CPM_HISTORY)[e];return t?t.history:[]}shouldUpdateFloorsConfigAdUnit(e){return 0!==this.getPmacAdUnitHistory(e).length}setFloorsConfig(e){let t=e();n.xI.log("Pmac Setting floors config",t),this.floorManager.setFloorsConfig(t)}constructor(e,t,r){this.floorRulesPromise=null,this.floorMin=null,this.config=e,this.floorManager=t,this.auctionData=r,this.floorMin=e.floorMin,n.xI.info("Pmac module initialized"),n.xI.info("Pmac floor min",this.floorMin)}}},288(e,t,r){r.d(t,{QG:()=>o,gl:()=>c,J2:()=>l,Av:()=>s,e7:()=>d});class o{static init(e){this.namespace=e,this.ensureQueueExists(),this.initialized=!0}static ensureQueueExists(){if(!this.namespace)throw Error("Prebid namespace not provided");this.namespace.que||(this.namespace.que=[])}static getNamespace(){if(!this.initialized)throw Error("PrebidQueue not initialized and no global Prebid found");return this.namespace}static push(e){this.getNamespace().que.push(e)}static on(e,t){this.push(()=>{this.getNamespace().onEvent(e,t)})}}o.initialized=!1;var i,n,a,s=((i={}).WIN="WIN",i.FLOORED="FLOORED",i.NOBIDS="NOBIDS",i),l=((n={}).ERROR="ERROR",n.WARNING="WARNING",n);let d={a:[0,1],b:[2,6],c:[7,11],d:[12,16],e:[17,Number.MAX_SAFE_INTEGER]};var c=((a={}).BID_REQUESTED="bidRequested",a.BID_RESPONSE_RECEIVED="bidResponseReceived",a.BID_RESPONSE_ERROR="bidResponseError",a.BID_RESPONSE_TIMEOUT="bidResponseTimeout",a.AUCTION_INIT="auctionInit",a.AUCTION_END="auctionEnd",a.AUCTION_DEBUG="auctionDebug",a)},944(e,t,r){r.d(t,{A:()=>s});var o=r(713),i=r(396),n=r(522);class a{static init(e){var t;(null==(t=window.__pubx__)?void 0:t.version)||this.initializePubx(e),this.initializeGpt()}static initializePubx(e){var t,r,o;window.__pubx__=(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){var o;o=r[t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o})}return e}({},window.__pubx__),o=o={version:"Custom Azerion Prebid + GAM-1768341860878",variant:"Custom Azerion Prebid + GAM",pageId:(0,i.lk)(),isRtd:!!e.isRtd,extraData:e.extraData||{},pubxGamQue:[],pubxFloors:{},loadTime:window.__loadTimestamp__?Date.now()-window.__loadTimestamp__:-1,loadTimestamp:Date.now(),pubxLogsEnabled:e.enableInstrumentationLogs&&1/e.samplingRate>Math.random(),abTestConfig:{},analytics:{auctionCache:{},auctionIdMap:new Map},pmacCpmHistory:{},nextfloorsConfig:null,pubxFloorFetchStatus:null,pubxLoaded:this.getPubxLoadedValue(e),loadedBeforePb:(null==e||null==(t=e.pbNamespace)?void 0:t.version)===void 0},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r})(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))}),r),window.__pubxFloorsConfig__=null,window.__pubxFloors__={},window.__pubxLoaded__=this.getPubxLoadedValue(e)}static initializeGpt(){window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[]}static getLiveWrappedStatus(){try{if(!window.livewrapped||"function"!=typeof window.livewrapped.info)return!1;let e=window.livewrapped.info();if(!e||"function"!=typeof e.upfm)return!1;return!!e.upfm()}catch(e){return n.x.log("LiveWrapped info api error",e),!1}}static getStandardPubxLoadedValue(e){var t;return(null==(t=window.__pubx__)?void 0:t.pubxLoaded)!==void 0?window.__pubx__.pubxLoaded:e.splitRate>100*Math.random()}static getPubxLoadedValue(e){if(void 0!==window.__pubxLoaded__)return window.__pubxLoaded__;switch("auctionData"){case a.INTEGRATION_TYPES.STANDARD:return a.getStandardPubxLoadedValue(e);case a.INTEGRATION_TYPES.AUCTION_DATA:return null;case a.INTEGRATION_TYPES.CUSTOM_LW:return a.getLiveWrappedStatus();default:return!1}}static getFromPubx(e,t){var r,o;return null!=(r=null==(o=window.__pubx__)?void 0:o[e])?r:t}static setToPubx(e,t){window.__pubx__?window.__pubx__[e]=t:n.x.error("Pubx State not initialized",{property:e,value:t})}static setFeatureFlag(e,t){this.featureFlags[e]=t}static isFeatureEnabled(e){var t;return null!=(t=this.featureFlags[e])&&t}static isPubxLoaded(){return!!this.getFromPubx(o.I.PUBX_LOADED,!1)}static setPubxLoaded(e){this.setToPubx(o.I.PUBX_LOADED,e)}static getExtraData(){return this.getFromPubx(o.I.EXTRA_DATA)}static setExtraData(e){this.setToPubx(o.I.EXTRA_DATA,e)}static getABTestConfig(){return this.getFromPubx(o.I.AB_TEST_CONFIG)}static setABTestConfig(e){this.setToPubx(o.I.AB_TEST_CONFIG,e)}static getGamQueue(){return this.getFromPubx(o.I.PUBX_GAM_QUE,[])}static setGamQueue(e){this.setToPubx(o.I.PUBX_GAM_QUE,e)}static addToGamQueue(e){let t=this.getGamQueue();t.push(e),this.setGamQueue(t)}static getGlobalFloors(){return window.__pubxFloors__||{}}static setGlobalFloors(e,t,r,o){let i=this.getGlobalFloors();i[e]=i[e]||{},i[e][t]=i[e][t]||{},i[e][t][r]=o,window.__pubxFloors__=i}static getGlobalFloorsConfig(){return window.__pubxFloorsConfig__}static setGlobalFloorsConfig(e){window.__pubxFloorsConfig__=e}static getFloorFetchStatus(){return this.getFromPubx(o.I.PUBX_FLOOR_FETCH_STATUS)}static setFloorFetchStatus(e){this.setToPubx(o.I.PUBX_FLOOR_FETCH_STATUS,e)}static getAnalytics(){return this.getFromPubx(o.I.ANALYTICS)}static setAnalytics(e){this.setToPubx(o.I.ANALYTICS,e)}static getLoadTime(){return this.getFromPubx(o.I.LOAD_TIME,0)}static getLoadTimestamp(){return this.getFromPubx(o.I.LOAD_TIMESTAMP,0)}static updatePubxLoadedFromAuctionData(e){let{arePubxFloorsSet:t}=r(998),o=e.adUnits.length>0&&e.adUnits.some(t);this.setPubxLoaded(o)}}a.featureFlags={},a.INTEGRATION_TYPES={STANDARD:"standard",AUCTION_DATA:"auctionData",CUSTOM_LW:"customLW"};let s=a},713(e,t,r){r.d(t,{I:()=>i});var o,i=((o={}).VARIANT="variant",o.VERSION="version",o.PUBX_LOADED="pubxLoaded",o.LOGGER="logger",o.IS_RTD="isRtd",o.PAGE_ID="pageId",o.EXTRA_DATA="extraData",o.PUBX_GAM_QUE="pubxGamQue",o.PUBX_FLOORS="pubxFloors",o.LOAD_TIMESTAMP="loadTimestamp",o.LOAD_TIME="loadTime",o.PUBX_LOGS_ENABLED="pubxLogsEnabled",o.AB_TEST_CONFIG="abTestConfig",o.ANALYTICS="analytics",o.PMAC_CPM_HISTORY="pmacCpmHistory",o.PUBX_FLOORS_CONFIG="pubxFloorsConfig",o.NEXTFLOORS_CONFIG="nextfloorsConfig",o.PUBX_FLOORS_API_STATUS="pubxFloorsApiStatus",o.PUBX_FLOOR_FETCH_STATUS="pubxFloorFetchStatus",o.LOADED_BEFORE_PB="loadedBeforePb",o.PUBX_DEFAULTS_AVAILABLE="pubxDefaultsAvailable",o.PUBX_FF_ALWAYS_ENABLED="pubxFFAlwaysEnabled",o)},309(e,t,r){r.d(t,{xI:()=>s.xI,Vy:()=>s.Vy,fN:()=>a.A,mf:()=>m,j0:()=>R,gb:()=>P,YJ:()=>I,YT:()=>s.YT});var o,i,n,a=r(944),s=r(733),l=r(670),d=r(685),c=r(998),u=r(396),g=r(512),p=r(817);class f{static getMetrics(e,t){return{bidderRT:this.getBidderRT(e,t),requestBidsRT:this.getRequestBidsRT(e)}}static getRequestBidsRT(e){let t={priceFloors:0,total:0};return["priceFloors","total"].forEach(r=>{let o=`requestBids.${r}`;void 0!==e[o]&&(t[r]=e[o])}),t}static getBidderRT(e,t){let r={};return t.forEach(t=>{let o=`adapters.client.${t}.total`;void 0!==e[o]?r[t]=Array.isArray(e[o])&&e[o][0]||0:r[t]=0}),r}}var b=((o={})[o.REJECTED=1]="REJECTED",o[o.RESPONSE=2]="RESPONSE",o[o.TIMEOUT=3]="TIMEOUT",o[o.WON=4]="WON",o[o.NO_BID=5]="NO_BID",o),_=((i={}).BID_TIMEOUT="bidTimeout",i.BID_RESPONSE="bidResponse",i.BID_REJECTED="bidRejected",i.AUCTION_END="auctionEnd",i.BID_WON="bidWon",i.NO_BID="noBid",i.BIDDER_ERROR="bidderError",i);let h=["bidTimeout","bidResponse","bidRejected","auctionEnd","bidWon","noBid","bidderError"];function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){var o;o=r[t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o})}return e}class E{getWindowLocation(){try{var e;return(null==(e=window.top)?void 0:e.location)||window.location}catch(e){return s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}}),window.location}}getPageDetails(){try{var e,t;let r=(null==(e=window.pubxTopContext)?void 0:e.pageUrl)||(null==(t=window.arTopContextProps)?void 0:t.page)||this.getWindowLocation().href;if(!r)throw Error("Missing pageUrl");let o=new URL(r);return{host:o.host,path:o.pathname,search:o.search}}catch(e){return s.xI.error("PubxAnalytics getPageDetails error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}}),{host:"",path:"",search:""}}}getAdServerDataForBid(e){try{let t=(null==e?void 0:e.adUnitCode)||"",r=(0,g.getGptSlotForAdUnitCode)(t);if(r)return Object.fromEntries(r.getTargetingKeys().filter(e=>e.startsWith("pubx-")||e.startsWith("hb_")&&1===(e.match(/_/g)||[]).length).map(e=>[e,r.getTargeting(e)]));return{}}catch(e){return s.xI.error("PubxAnalytics getAdServerDataForBid error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.WARNING,payload:{error:e instanceof Error?e.message:String(e)}}),{}}}extractBid(e){return{auctionId:this.getAuctionId(e.auctionId),adUnitCode:e.adUnitCode,gptSlotCode:(0,g.getGptSlotInfoForAdUnitCode)(e.adUnitCode).gptSlot||null,bidderCode:e.bidder,cpm:e.cpm,originalCpm:e.originalCpm,originalCurrency:e.originalCurrency,creativeId:e.creativeId,dealId:e.dealId,currency:e.currency,floorData:e.floorData,mediaType:e.mediaType,netRevenue:e.netRevenue,requestTimestamp:e.requestTimestamp,responseTimestamp:e.responseTimestamp,status:e.status,sizes:(0,u.kK)(e.size).toString(),statusMessage:e.statusMessage,timeToRespond:e.timeToRespond,transactionId:e.transactionId,bidId:e.bidId||e.requestId,placementId:e.params?function(e,t,r,o,i){for(t=t.split?t.split("."):t,o=0;o<t.length;o++)e=e?e[t[o]]:void 0;return void 0===e?void 0:e}(e,"params.0.placementId"):null,source:e.source||"null"}}getAuctionId(e){try{if(!e)throw Error(`Missing auctionId (${e}) provided to PubxAnalytics in bidResponse`);if(e&&"string"==typeof e&&(0,u.Qg)(e))return e;if(e&&this.auctionIdMap.has(e))return this.auctionIdMap.get(e);let t=(0,u.lk)();return this.auctionIdMap.set(e,t),s.xI.log("Generated new auctionId for invalid auctionId",{originalId:e,generatedId:t}),t}catch(t){if(s.xI.error("PubxAnalytics getAuctionId error:",t),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:t instanceof Error?t.message:String(t)}}),!e)return(0,u.lk)();return e}}track(e,t){try{switch(e){case _.BID_TIMEOUT:t.map(this.extractBid.bind(this)).forEach(e=>{e.bidType=b.TIMEOUT,this.addBidToCache(e)});break;case _.BID_RESPONSE:{let e=Object.assign(this.extractBid(t),{bidType:b.RESPONSE});this.addBidToCache(e);break}case _.BID_REJECTED:{let e=Object.assign(this.extractBid(t),{bidType:b.REJECTED});this.addBidToCache(e);break}case _.NO_BID:{let e=Object.assign(this.extractBid(t),{bidType:b.NO_BID});this.addBidToCache(e);break}case _.BIDDER_ERROR:this.processBidderError(t);break;case _.AUCTION_END:this.processAuctionEnd(t);break;case _.BID_WON:this.processBidWon(t)}}catch(e){s.xI.error("PubxAnalytics track error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}getConsentMetadata(){try{var e,t;return(null==(e=(t=this.prebidInstance).getConsentMetadata)?void 0:e.call(t))||{}}catch(e){return s.xI.error("PubxAnalytics getConsentMetadata error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.WARNING,payload:{error:e instanceof Error?e.message:String(e)}}),{}}}getUserIds(){try{var e,t;return(null==(e=(t=this.prebidInstance).getUserIds)?void 0:e.call(t))||{}}catch(e){return s.xI.error("PubxAnalytics getUserIds error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.WARNING,payload:{error:e instanceof Error?e.message:String(e)}}),{}}}addBidToCache(e){this.auctionCache[e.auctionId]||this.initializeAuctionCache(e.auctionId),this.auctionCache[e.auctionId].bids.push(e)}getPubxCohort(){return window.__pubx__&&"object"==typeof window.__pubx__&&void 0!==window.__pubx__.pubxLoaded?window.__pubx__.pubxLoaded?"B":"A":window.__pubxLoaded__?"B":"A"}initializeAuctionCache(e){var t,r,o;let i=++this.auctionRankCounter;this.auctionRankMap.set(i,e),this.auctionCache[e]={bids:[],winningBids:[],auctionDetail:{auctionRank:i,auctionId:e,previousAuctionId:this.auctionRankMap.get(i-1)||null},pubxDetail:{pubxCohort:this.getPubxCohort()},floorDetail:{},adUnitDetails:[],pageDetail:this.getPageDetails(),deviceDetail:{platform:navigator.platform,deviceType:(0,p.ZI)(),deviceOS:(0,p.R0)(),browser:(0,p.X5)()},userDetail:{userIdTypes:Object.keys(this.getUserIds())},consentDetail:{consentTypes:Object.keys(this.getConsentMetadata())},pmacDetail:{pmac_data:[]},extraData:(null==(t=window.__pubx__)?void 0:t.extraData)||{},initOptions:(r=O({},this.initOptions),o=o={auctionId:e},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r})(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))}),r),sendAs:[],performanceMetrics:{},bidderErrors:[]}}collectAuctionAdunitData(e){try{let t=this.getAuctionId(e.auctionId),r=e.bidderRequests,o=e.adUnits,i=new Map;for(let e of o){let t=e.code,r=(0,d.rz)(e,null),o=Object.entries(e.mediaTypes||{}).reduce((e,[t,r])=>("video"===t&&(null==r?void 0:r.context)?e.push(`video:${r.context}`):e.push(t),e),[]);i.set(t,{adunitCode:t,gptSlotCode:(0,g.getGptSlotInfoForAdUnitCode)(t).gptSlot||null,gpid:r,mediaTypes:o,bidders:[],refreshRank:void 0})}for(let e of r)for(let t of e.bids){if(!t.adUnitCode){s.xI.error("PubxAnalytics collectAuctionAdunitData error: Missing adUnitCode in bidderRequest",e);continue}let r=i.get(t.adUnitCode);r&&(r.bidders.push(t.bidder),r.refreshRank=t.auctionsCount||t.bidRequestsCount),i.set(t.adUnitCode,r)}this.auctionCache[t].adUnitDetails=Array.from(i.values())}catch(e){s.xI.error("PubxAnalytics collectAuctionAdunitData error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}collectAndStoreAuctionFeedbackData(e){try{let t=this.getAuctionId(e.auctionId),r=[];e.adUnits.forEach(o=>{let{adUnitStatus:i,originalBidCpmValue:n,bidCurrency:a,adserverTargeting:s,floorData:l,floorProvider:u,floorSkipStatus:g,floorModelVersion:p}=(0,d.sZ)(o,e,this.config),f={auctionId:t,auctionRank:this.auctionRankCounter,adUnitCode:o.code,status:i,bidCurrency:a,bidValue:n,pubCurrency:this.config.currency,adserverTargeting:s,floorData:(0,c.formatFloorData)(l),floorProvider:u,floorSkipStatus:g,floorModelVersion:p};r.push(f)}),Object.assign(this.auctionCache[t].pmacDetail,{pmac_data:r})}catch(o){s.xI.error("PubxAnalytics collectAndStoreAuctionFeedbackData error:",o),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:o instanceof Error?o.message:String(o)}});let t=this.getAuctionId(e.auctionId),r=e.adUnits.map(e=>({auctionId:t,auctionRank:this.auctionRankCounter,adUnitCode:e.code,pubCurrency:this.config.currency}));Object.assign(this.auctionCache[t].pmacDetail,{pmac_data:r})}}processAuctionEnd(e){try{var t,r;let o=this.getAuctionId(e.auctionId);this.auctionCache[o]||this.initializeAuctionCache(o),Object.assign(this.auctionCache[o].floorDetail,(null==(t=e.adUnits)?void 0:t.map(e=>{var t,r;return(null==e||null==(t=e.bids)?void 0:t.length)&&(null==(r=e.bids[0])?void 0:r.floorData)}).find(e=>e))||{}),this.auctionCache[o].deviceDetail.cdep=e.bidderRequests.map(e=>{var t,r,o;return null==(o=e.ortb2)||null==(r=o.device)||null==(t=r.ext)?void 0:t.cdep}).find(e=>e),Object.assign(this.auctionCache[o].auctionDetail,{adUnitCodes:(null==(r=e.adUnits)?void 0:r.map(e=>e.code))||[],timestamp:e.timestamp}),e.metrics&&e.metrics.getMetrics&&"function"==typeof e.metrics.getMetrics&&(this.auctionCache[o].performanceMetrics=function(e){try{var t,r;let o=(null==(t=e.metrics)?void 0:t.getMetrics())||{},i=(null==(r=e.bidderRequests)?void 0:r.map(e=>e.bidderCode))||[];return f.getMetrics(o,i)}catch(e){return console.error("Error creating performance metrics:",e),f.getMetrics({},[])}}(e)),this.collectAndStoreAuctionFeedbackData(e),this.collectAuctionAdunitData(e),this.prepareAuctionSend(o)}catch(e){s.xI.error("PubxAnalytics processAuctionEnd error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}getBidderErrorMessage(e){return e.message&&e.message.length>0?e.message:e.statusText&&e.statusText.length>0?e.statusText:e.reason&&e.reason.length>0?e.reason:"Unknown error"}processBidderError(e){try{let{error:t,bidderRequest:r}=e,o=this.getAuctionId(null==r?void 0:r.auctionId);this.auctionCache[o]||this.initializeAuctionCache(o);let i=Array.isArray(null==r?void 0:r.bids)?r.bids:[],n=i.map(e=>e.adUnitCode).filter(Boolean),a={auctionId:o,bidderCode:(null==r?void 0:r.bidderCode)||"unknown",error:{status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,message:this.getBidderErrorMessage(t)},timedOut:null==r?void 0:r.timedOut,timeout:null==r?void 0:r.timeout,affectedAdUnits:n,bidCount:i.length,timestamp:Date.now()};this.auctionCache[o].bidderErrors.push(a)}catch(e){s.xI.error("PubxAnalytics processBidderError error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}processBidWon(e){try{let t=this.extractBid(e);this.auctionCache[t.auctionId]||this.initializeAuctionCache(t.auctionId);let r=this.auctionCache[t.auctionId].floorDetail;Object.assign(t,{floorProvider:(null==r?void 0:r.floorProvider)||null,floorFetchStatus:(null==r?void 0:r.fetchStatus)||null,floorLocation:(null==r?void 0:r.location)||null,floorModelVersion:(null==r?void 0:r.modelVersion)||null,floorSkipRate:(null==r?void 0:r.skipRate)||0,isFloorSkipped:(null==r?void 0:r.skipped)||!1,isWinningBid:!0,renderedSize:e.size,bidType:b.WON,adServerData:this.getAdServerDataForBid(t)}),this.auctionCache[t.auctionId].winningBids.push(t),this.prepareSendWinningBids(t)}catch(e){s.xI.error("PubxAnalytics processBidWon error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}shouldFireEventRequest(e=""){try{var t;let r=null!=(t=this.initOptions.samplingRate)?t:1;return parseInt((0,u.PB)(e))%r==0}catch(e){return s.xI.error("PubxAnalytics shouldFireEventRequest error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}}),!1}}prepareSendWinningBids(e){try{let{auctionId:t}=e;if(!this.shouldFireEventRequest(t))return;let r=Object.assign({},this.auctionCache[t]);r.winningBid=e;let o={path:E.winningBidPath,requiredKeys:["winningBid","pageDetail","deviceDetail","floorDetail","auctionDetail","userDetail","consentDetail","pmacDetail","extraData","initOptions","performanceMetrics"],eventType:"win"};this.sendData(o,r)}catch(e){s.xI.error("PubxAnalytics prepareSendWinningBids error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}prepareAuctionSend(e){try{if(!this.shouldFireEventRequest(e))return;let t=O({},this.auctionCache[e]),r={path:E.auctionPath,requiredKeys:["bids","pageDetail","deviceDetail","floorDetail","pubxDetail","auctionDetail","userDetail","adUnitDetails","consentDetail","pmacDetail","extraData","initOptions","performanceMetrics","bidderErrors"],eventType:"auction"};if(this.auctionCache[e].sendAs.includes(r.eventType))return;this.sendData(r,t),this.auctionCache[e].sendAs.push(r.eventType)}catch(e){s.xI.error("PubxAnalytics prepareAuctionSend error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}}sendData(e,t){try{if(!e.requiredKeys.every(e=>!!t[e]))return;let r=(0,u.c$)({protocol:"https",hostname:this.initOptions.hostName||E.defaultHost,pathname:e.path,search:{auctionTimestamp:t.auctionDetail.timestamp,pubxaiAnalyticsVersion:"v2.4.0",prebidVersion:this.prebidInstance.version.split("v")[1],pubxId:this.initOptions.pubxId}}),o=Object.fromEntries(e.requiredKeys.map(e=>[e,t[e]])),i=JSON.stringify([o]);fetch(r,{method:"POST",body:i,headers:{"Content-Type":"text/plain"}})}catch(e){s.xI.error("PubxAnalytics sendData error:",e),s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.FATAL,payload:{error:e instanceof Error?e.message:String(e)}})}}setupPrebidListeners(){this.prebidInstance.onEvent("auctionEnd",e=>{this.track(_.AUCTION_END,e)}),this.prebidInstance.onEvent("bidResponse",e=>{this.track(_.BID_RESPONSE,e)}),this.prebidInstance.onEvent("bidRejected",e=>{this.track(_.BID_REJECTED,e)}),this.prebidInstance.onEvent("bidTimeout",e=>{this.track(_.BID_TIMEOUT,e)}),this.prebidInstance.onEvent("bidWon",e=>{this.track(_.BID_WON,e)}),this.prebidInstance.onEvent("bidderError",e=>{this.track(_.BIDDER_ERROR,e)})}logMissedEvents(){this.prebidInstance.getEvents().filter(e=>h.includes(e.eventType)).forEach(e=>{this.track(e.eventType,e.args)})}initialise(){this.logMissedEvents(),this.setupPrebidListeners()}constructor(e,t,r){this.auctionCache={},this.auctionRankCounter=0,this.auctionIdMap=new Map,this.auctionRankMap=new Map,window.__pubx__=window.__pubx__||{},window.__pubx__.analytics={auctionCache:this.auctionCache,auctionIdMap:this.auctionIdMap},this.initOptions=O({samplingRate:1},e),this.config=r,this.prebidInstance=t}}E.defaultHost="api.pbxai.com",E.auctionPath="/analytics/auction",E.winningBidPath="/analytics/bidwon";class R{init(){this.config.pbNamespace.que.push(()=>{try{let e=this.config.pbNamespace,t=this.config.pbNamespace.version.replace("v","");if(this.enablePrebidAnalytics){s.xI.log("Prebid Analytics is enabled for Prebid version: ",t);let r={provider:d.hU,options:{samplingRate:this.config.samplingRate,pubxId:this.config.pubxId}};(0,d.Aj)(e,r);return}s.xI.log("Pubx Analytics is enabled for Prebid version: ",t);let r={pubxId:this.config.pubxId,samplingRate:this.config.samplingRate};new E(r,e,this.config).initialise()}catch(e){s.Vy.logScriptError({code:l.O4.PUBX_ANALYTICS_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}})}constructor(e,t=!1){this.config=e,this.enablePrebidAnalytics=t}}class m{static initConfig(){if(m.pbConfig={splitRate:100,samplingRate:1,enableInstrumentationLogs:!1,pbNsKeys:"pgPrebid",pbNamespace:null,currency:"USD",modelVersion:"cb_AB_z_dt_0.75_dwt_1_dnt_0.1",auctionDelay:100,pubxId:"251fdff9-3043-42e6-a6f4-35500425a8a6",accountId:"a732220c-f51a-4b23-a833-05e981d2db5c",schema:["gptSlot","mediaType"],floorFetchUrl:"https://floor.pbxai.com/?pubxId=251fdff9-3043-42e6-a6f4-35500425a8a6",floorMin:null,floorEnforcement:'{"floorDeals": true}',hbPbKey:"hb_pb",pubxSplitKey:"pubx-a",pubxSplitOnValue:"on",pubxSplitOffValue:"off",pubxOptimizedKey:"pubx-op",pubxOptimizedOnValue:"on",pubxOptimizedOffValue:"off",pubxMvKey:"pubx-m_v",pubxFloorKey:"pubx-floor",pubxFloorMvKey:"pubx-floor-mv",pubxABSplitAKey:"pubx-exp-A",pubxABSplitBKey:"pubx-exp-B",pubxTimeoutKey:"pubx-tm",pubxTimeoutOptimizedValue:"on",pubxTimeoutUnoptimizedValue:"off",pubxGamKey:"pubx-gm",pubxGamOnValue:"on",pubxGamOffValue:"off",pubxExperiments:{}},m.gamConfig={flooredBidMultiplier:.75,noBidMultiplier:.1,winBidMultiplier:1,pmacFloorMultiplier:.5,decayRate:1,gamBuckets:[{pbx_a0d_n:[0,.03]},{pbx_a1d_n:[.03,.06]},{pbx_a2d_n:[.06,.09]},{pbx_a3d_n:[.09,.12]},{pbx_a4d_n:[.12,.15]},{pbx_b0d_n:[.15,.2]},{pbx_b1d_n:[.2,.25]},{pbx_b2d_n:[.25,.3]},{pbx_b3d_n:[.3,.35]},{pbx_b4d_n:[.35,.4]},{pbx_b5d_n:[.4,.45]},{pbx_b6d_n:[.45,.5]},{pbx_b7d_n:[.5,.55]},{pbx_b8d_n:[.55,.6]},{pbx_b9d_n:[.6,.65]},{pbx_b10d_n:[.65,.7]},{pbx_b11d_n:[.7,.75]},{pbx_b12d_n:[.75,.8]},{pbx_b13d_n:[.8,.85]},{pbx_b14d_n:[.85,.9]},{pbx_b15d_n:[.9,.95]},{pbx_b16d_n:[.95,1]},{pbx_c0d_n:[1,1.1]},{pbx_c1d_n:[1.1,1.2]},{pbx_c2d_n:[1.2,1.3]},{pbx_c3d_n:[1.3,1.4]},{pbx_c4d_n:[1.4,1.5]},{pbx_c5d_n:[1.5,1.6]},{pbx_c6d_n:[1.6,1.7]},{pbx_c7d_n:[1.7,1.8]},{pbx_c8d_n:[1.8,1.9]},{pbx_c9d_n:[1.9,2]},{pbx_d0d_n:[2,2.25]},{pbx_d1d_n:[2.25,2.5]},{pbx_d2d_n:[2.5,2.75]},{pbx_d3d_n:[2.75,3]},{pbx_d4d_n:[3,3.25]},{pbx_d5d_n:[3.25,3.5]},{pbx_d6d_n:[3.5,3.75]},{pbx_d7d_n:[3.75,4]},{pbx_d8d_n:[4,4.25]},{pbx_d9d_n:[4.25,4.5]},{pbx_d10d_n:[4.5,4.75]},{pbx_d11d_n:[4.75,5]},{pbx_d12d_n:[5,111111]}],sendFloorsToGam:!0},!m.pbConfig)throw Error("Global __PB_CONFIG__ not found - ConfigManager.initConfig() cannot continue.");if(!m.gamConfig)throw Error("Global __GAM_CONFIG__ not found - ConfigManager.initConfig() cannot continue.");m.pbConfig.floorFetchUrl=`${m.pbConfig.floorFetchUrl}&page=${encodeURIComponent(window.location.href)}`,m.prebidConfigs=m.getPbConfigs(m.pbConfig),m.prebidGamConfigs=m.getPbGamConfigs(m.prebidConfigs,m.gamConfig)}static getPbConfigs(e){return e.pbNsKeys.split(",").map(t=>Object.assign({},e,{pbNamespace:(0,d.Qe)(t),pbNamespaceKey:t}))}static getPbGamConfigs(e,t){return e.map(e=>Object.assign({},e,t))}static getPrebidConfigs(){if(!m.prebidConfigs)throw Error("ConfigManager not initialised - call initConfig() first.");return m.prebidConfigs}static getPrebidGamConfigs(){if(!m.prebidGamConfigs)throw Error("ConfigManager not initialised - call initConfig() first.");return m.prebidGamConfigs}}let y="adunitCode";var A=r(713),v=r(748);class I{generateAuctionKeyValues(){let e={};try{this.auctionEndData.adUnits.forEach(t=>{let r=this.generateKeyValues(t,this.auctionEndData);this.addKVToResult(e,t,r),this.storeKeyValuesInState(t,this.auctionEndData.auctionId,r)})}catch(e){s.Vy.logScriptError({code:l.O4.KEY_VALUE_MANAGER_ERROR,severity:l.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}return s.xI.log(`Key-values generated for auction ${this.auctionEndData.auctionId}`,e),e}addKVToResult(e,t,r){switch(this.kvMappingKey){case y:default:e[t.code]=r;break;case"gpid":var o,i;e[(null==(i=t.ortb2Imp)||null==(o=i.ext)?void 0:o.gpid)||""]=r}}getPubxSplitValue(e,t){let r=a.A.getFromPubx(A.I.PUBX_LOADED);return t.isTimeoutSegregated&&(0,c.isFloorFetchTimedOut)(e)?t.pubxSplitTimeoutValue:r?t.pubxSplitOnValue:t.pubxSplitOffValue}getPubxOptimizedValue(e,t,r=null){let o=(0,c.arePubxFloorsSkipped)(e);return!r||r.length<=0?this.NA_VALUE:o?t.pubxOptimizedOffValue:t.pubxOptimizedOnValue}getSplitKeyVals(e,t){let r={},o=this.getPubxSplitValue(e,t);r[t.pubxSplitKey]=o;let i=(0,c.getFloorFetchStatus)(e),n=o===t.pubxSplitOffValue;if(i===v.Xx.TIMEOUT&&(r[t.pubxTimeoutKey]=n?t.pubxTimeoutUnoptimizedValue:t.pubxTimeoutOptimizedValue),r[t.pubxGamKey]=t.sendFloorsToGam?t.pubxGamOnValue:t.pubxGamOffValue,o!==t.pubxSplitOnValue)return r;let a=(0,c.getFloorModelVersion)(e);return t.modelVersion!==a&&(r[t.pubxOptimizedKey]=this.getPubxOptimizedValue(e,t,a)),r}getMvKeyVals(e,t){let r={},o=(0,c.getMvmVersion)(e);return r[t.pubxMvKey]=null!=o?o:this.NA_VALUE,r}getFloorMvValue(e,t){return e+"-"+t}getFloorsMvKeyVals(e,t,r){var o;let i={},n=(0,c.getPubxFloorValue)(e,r);i[r.pubxFloorKey]=n;let a=null!=(o=(0,c.getMvmVersion)(t))?o:this.NA_VALUE,s=this.getFloorMvValue(n,a);return i[r.pubxFloorMvKey]=s,i}getTagManagementABTestKeyVals(e,t){let r={},o=t[e.pubxSplitKey]===e.pubxSplitOnValue;return r[e.pubxABSplitAKey]=o?"on-v2":"off-v2",r}generateKeyValues(e,t){var r;let o=this.getSplitKeyVals(e,this.config);if((r=this.config.pubxExperiments)&&void 0!==(null==r?void 0:r.tmAbTest)&&r.tmAbTest&&Object.assign(o,this.getTagManagementABTestKeyVals(this.config,o)),!(0,c.arePubxFloorsSet)(e))return o;let i=(0,c.getFloorModelVersion)(e),n=(0,d.sZ)(e,t,this.config),a=(0,d.PM)(n,i,this.config);if(!a)return o;let l=this.config.sendFloorsToGam&&this.config.pubxGamKey in o&&o[this.config.pubxGamKey]===this.config.pubxGamOnValue;return s.xI.log("pubx: sendFloorsToGam",l),Object.assign(o,this.getMvKeyVals(i,this.config)),l&&Object.assign(o,this.getFloorsMvKeyVals(a,i,this.config)),o}storeKeyValuesInState(e,t,r){let o=a.A.getFromPubx("pubxFloors",{});null!=o[t]||(o[t]={}),o[t][e.code]=r,a.A.setToPubx("pubxFloors",o),Object.entries(r).forEach(([r,o])=>{a.A.setGlobalFloors(t,e.code,r,o)})}constructor(e,t){this.kvMappingKey=y,this.NA_VALUE="NA",this.config=e,this.auctionEndData=t,this.kvMappingKey="adunitCode"}}r(288);var S=((n={}).GAM="gam",n.GAM_LIVEWRAPPED="gamLW",n.NONE="none",n);function x(e,t,r,o,i,n,a){try{var s=e[n](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(o,i)}class P{static register(e,t){var o;return(o=function*(){let o;if((t=t||S.NONE)===S.GAM){let{GamAdserverManager:t}=yield Promise.resolve().then(r.bind(r,949));o=new t(e)}else if(t===S.GAM_LIVEWRAPPED){let{GamLivewrappedAdserverManager:t}=yield Promise.resolve().then(r.bind(r,878));o=new t(e)}else{let{NullAdserverManager:t}=yield Promise.resolve().then(r.bind(r,223));o=new t(e)}let i=`${t}-${e.pbNamespaceKey}`;s.xI.log(`Registering adserver: ${i}`,o,P.adservers),o.initialize(),P.adservers.set(i,o)},function(){var e=this,t=arguments;return new Promise(function(r,i){var n=o.apply(e,t);function a(e){x(n,r,i,a,s,"next",e)}function s(e){x(n,r,i,a,s,"throw",e)}a(void 0)})})()}static get(e,t){let r=`${e}-${t}`;return this.adservers.get(r)}static getAll(){return Array.from(this.adservers.values())}static has(e,t){let r=`${e}-${t}`;return this.adservers.has(r)}static clear(){this.adservers.clear()}}P.adservers=new Map},670(e,t,r){r.d(t,{MU:()=>a,O1:()=>d,O4:()=>n,fC:()=>l,rZ:()=>s});var o,i,n=((o={}).FLOORS_INIT_ERROR="FLOORS_INIT_ERROR",o.FLOORS_CALLBACK_ERROR="FLOORS_CALLBACK_ERROR",o.ADSERVER_INIT_ERROR="ADSERVER_INIT_ERROR",o.GAM_CLEAR_KEY_VALUES_ERROR="GAM_CLEAR_KEY_VALUES_ERROR",o.GPT_API_NOT_AVAILABLE="GPT_API_NOT_AVAILABLE",o.GPT_SLOT_NOT_FOUND="GPT_SLOT_NOT_FOUND",o.GAM_QUE_GPT_SLOT_NOT_FOUND="GAM_QUE_GPT_SLOT_NOT_FOUND",o.GAM_BUCKET_NOT_FOUND="GAM_BUCKET_NOT_FOUND",o.KEY_VALUE_MANAGER_ERROR="KEY_VALUE_MANAGER_ERROR",o.SET_KEY_VALUES_ERROR="SET_KEY_VALUES_ERROR",o.INVALID_PREBID_NAMESPACE="INVALID_PREBID_NAMESPACE",o.CALC_FLOOR_NOT_FOUND="CALC_FLOOR_NOT_FOUND",o.IMPROVEMEDIA_API_NOT_FOUND="IMPROVEMEDIA_API_NOT_FOUND",o.INVESTING_FILTER_NOT_FOUND="INVESTING_FILTER_NOT_FOUND",o.PUBX_AA_NOT_FOUND="PUBX_AA_NOT_FOUND",o.PRICE_FLOORS_NOT_FOUND="PRICE_FLOORS_NOT_FOUND",o.NON_PUBX_FLOORS_FOUND="NON_PUBX_FLOORS_FOUND",o.CURRENCY_INVALID_INPUT="CURRENCY_INVALID_INPUT",o.CURRENCY_MODULE_NOT_INSTALLED="CURRENCY_MODULE_NOT_INSTALLED",o.GET_FLOOR_NOT_FOUND="GET_FLOOR_NOT_FOUND",o.NO_BID_FLOOR_RULE_NOT_FOUND="NO_BID_FLOOR_RULE_NOT_FOUND",o.TAG_DEFAULT_VALUES_NOT_FOUND="TAG_DEFAULT_VALUES_NOT_FOUND",o.PUBX_OFF_FLOORS_FOUND="PUBX_OFF_FLOORS_FOUND",o.MODEL_VERSION_NOT_FOUND_READ="MODEL_VERSION_NOT_FOUND_READ",o.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG="PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG",o.INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE="INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE",o.MISSING_ADUNIT_FLOOR_RESPONSE="MISSING_ADUNIT_FLOOR_RESPONSE",o.PMAC_FLOOR_RESPONSE_NOT_AVAILABLE="PMAC_FLOOR_RESPONSE_NOT_AVAILABLE",o.UNCAUGHT_ERROR="UNCAUGHT_ERROR",o.UNCAUGHT_GAM_ERROR="UNCAUGHT_GAM_ERROR",o.PUBX_ANALYTICS_ERROR="PUBX_ANALYTICS_ERROR",o.FLOORS_RESPONSE_INVALID="FLOORS_RESPONSE_INVALID",o.BILLABLE_EVENT_ERROR="BILLABLE_EVENT_ERROR",o),a=((i={}).WARNING="WARNING",i.ERROR="ERROR",i.FATAL="FATAL",i);let s={FLOORS_INIT_ERROR:{message:"Floors Module initialization error",severity:"ERROR"},FLOORS_CALLBACK_ERROR:{message:"Floors Module callback error",severity:"ERROR"},ADSERVER_INIT_ERROR:{message:"Adserver Module initialization error",severity:"ERROR"},GAM_CLEAR_KEY_VALUES_ERROR:{message:"Error clearing key-values in GAM",severity:"ERROR"},GPT_API_NOT_AVAILABLE:{message:"GPT API not available",severity:"ERROR"},GPT_SLOT_NOT_FOUND:{message:"GPT Slot not found",severity:"WARNING"},GAM_QUE_GPT_SLOT_NOT_FOUND:{message:"Gam Que: GPT Slot not found",severity:"ERROR"},GAM_BUCKET_NOT_FOUND:{message:"GAM Bucket not found",severity:"WARNING"},KEY_VALUE_MANAGER_ERROR:{message:"Error in KeyValueManager.processAuctionData:",severity:"ERROR"},SET_KEY_VALUES_ERROR:{message:"Error setting key-values",severity:"ERROR"},INVALID_PREBID_NAMESPACE:{message:"Invalid Prebid Namespace",severity:"FATAL"},CALC_FLOOR_NOT_FOUND:{message:"floorWithStatus not found",severity:"FATAL"},IMPROVEMEDIA_API_NOT_FOUND:{message:"lwhbim.adServerKeywordsAdUnit is not defined",severity:"ERROR"},INVESTING_FILTER_NOT_FOUND:{message:"window._imhb_auctions is not defined",severity:"ERROR"},PUBX_AA_NOT_FOUND:{message:"pubxaiAnalyticsAdapter module is not installed",severity:"WARNING"},PRICE_FLOORS_NOT_FOUND:{message:"priceFloors module is not installed",severity:"ERROR"},NON_PUBX_FLOORS_FOUND:{message:"Non-pubx floor provider present",severity:"WARNING"},CURRENCY_INVALID_INPUT:{message:"Invalid input types for currency conversion",severity:"WARNING"},CURRENCY_MODULE_NOT_INSTALLED:{message:"currency module of prebid.js is not installed",severity:"WARNING"},GET_FLOOR_NOT_FOUND:{message:"calc nbids - None of bidderRequests.bids.getFloor() is defined",severity:"WARNING"},NO_BID_FLOOR_RULE_NOT_FOUND:{message:"calc nbids - Floor rule not found in __pubxFloorsConfig__ and __nextfloorsConfig__",severity:"WARNING"},TAG_DEFAULT_VALUES_NOT_FOUND:{message:"defaultValues of *|banner in config is undefined",severity:"ERROR"},PUBX_OFF_FLOORS_FOUND:{message:"pubxLoaded is false but has floorData",severity:"FATAL"},MODEL_VERSION_NOT_FOUND_READ:{message:"floorModelVersion is undefined but adUnit.bids is not",severity:"FATAL"},PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG:{message:"PMAC floor multiplier not found in config",severity:"ERROR"},INVALID_SCHEMA_FIELDS_FLOORS_RESPONSE:{message:"Invalid schema fields in floor rules response, expected only ['gptSlot']",severity:"ERROR"},MISSING_ADUNIT_FLOOR_RESPONSE:{message:"adUnitCode not found in floor rules response",severity:"ERROR"},PMAC_FLOOR_RESPONSE_NOT_AVAILABLE:{message:"Floors Reponse not available for pmac",severity:"WARNING"},UNCAUGHT_ERROR:{message:"Uncaught Error",severity:"FATAL"},UNCAUGHT_GAM_ERROR:{message:"Uncaught GAM Error",severity:"ERROR"},PUBX_ANALYTICS_ERROR:{message:"Pubx Analytics Error",severity:"ERROR"},FLOORS_RESPONSE_INVALID:{message:"Floors Response Invalid",severity:"ERROR"},BILLABLE_EVENT_ERROR:{message:"Error reporting billable event",severity:"ERROR"}},l=e=>{var t;let{code:r,adUnitCode:o,payload:i}=e,{message:n,severity:a}=null!=(t=s[r])?t:{message:"Undefined error",severity:"ERROR"};return{code:r,severity:a,message:n,adUnitCode:o,payload:i}},d=e=>{let t=Object.keys(s).find(t=>s[t].message===e)||"UNCAUGHT_ERROR";return{code:t,message:s[t].message,severity:s[t].severity}}},998(e,t,r){r.r(t),r.d(t,{arePubxFloorsSet:()=>b,arePubxFloorsSkipped:()=>p,constructStaticFloorsConfig:()=>N,constructStaticFloorsConfigFromGlobal:()=>T,formatFloorData:()=>y,getAdUnitBidModelVersion:()=>f,getAdUnitFloorFetchTimeoutStatus:()=>_,getDecayRateFromModelVersion:()=>U,getDefaultFloorRulesData:()=>C,getFloorBucket:()=>m,getFloorFetchStatus:()=>D,getFloorModelVersion:()=>O,getFloorModelVersionForLogs:()=>P,getFloorMultiplier:()=>F,getFloorRuleKey:()=>v,getFloorRuleKeyByAdUnitCode:()=>I,getFloorRuleValue:()=>S,getFloorRuleValueByAdUnitCode:()=>x,getMvmVersion:()=>E,getPubxFloorValue:()=>R,isFloorFetchTimedOut:()=>h});var o=r(522),i=r(944),n=r(991),a=r(288),s=r(713),l=r(670),d=r(685);function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){var o;o=r[t],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o})}return e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r.push.apply(r,o)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}function g(e,t){if(null==e)return{};var r,o,i,n={};if("u">typeof Reflect&&Reflect.ownKeys){for(i=0,r=Reflect.ownKeys(e);i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o]);return n}if(n=function(e,t){if(null==e)return{};var r,o,i={},n=Object.getOwnPropertyNames(e);for(o=0;o<n.length;o++)r=n[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r]);return i}(e,t),Object.getOwnPropertySymbols)for(i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o]);return n}let p=e=>e.bids.some(({floorData:e})=>e&&e.floorProvider===n.Kq.PUBX&&e.skipped),f=e=>{let{floorData:t}=e;if(t&&t.floorProvider===n.Kq.PUBX&&t.modelVersion)return t.modelVersion},b=e=>{let t=e.bids.some(e=>!!f(e)),r=e.bids.some(e=>{var t,r;return(null==e||null==(t=e.floorData)?void 0:t.skipRate)!==void 0&&(null==e||null==(r=e.floorData)?void 0:r.skipRate)<100});return t&&r},_=e=>{let{floorData:t}=e;if(t&&("timeout"===t.fetchStatus||"error"===t.fetchStatus))return t.fetchStatus},h=e=>{let t=e.bids.some(_),r=e.bids.some(e=>{var t;return(null==e||null==(t=e.floorData)?void 0:t.floorProvider)===n.Kq.PUBX_TIMEOUT});return t||r},O=e=>{let t=e.bids.map(f).filter(e=>void 0!==e)[0];if(void 0===t)throw Error("Floor model version not found for adUnit "+e.code);return t},E=e=>e.includes("_AB_")?e.split("_AB_")[1].split("_")[0]:void 0,R=(e,t)=>{let r=m(e.floorValue,t.gamBuckets);if(void 0===r)return o.x.error("Floor bucket not found for "+JSON.stringify(e)),"NA";let i=Object.keys(r)[0],n=e.status===a.Av.WIN?"_w":e.status===a.Av.FLOORED?"_f":"_n";return i.split("_n")[0]+n},m=(e,t)=>{if(0===t.length)throw Error("No floor buckets configured");return e<=0?t[0]:t.find(t=>{let r=Object.keys(t)[0],[o,i]=t[r];return e>o&&e<=i})},y=e=>{if(void 0!==e)return{floorValue:e.floorValue,floorRule:e.floorRule,floorCurrency:e.floorCurrency}},A=e=>"|banner"+(e.fields.includes("size")?"|*":""),v=(e,t,r)=>{let o=Object.keys(t),i=A(r);return o.find(t=>[e.getAdUnitPath()+i,e.getSlotElementId()+i].includes(t))},I=(e,t,r)=>Object.keys(t).find(t=>t.split(A(r))[0]===e),S=(e,t)=>{if(t){let r=v(e,t.floors.data.values,t.floors.data.schema);if(r)return t.floors.data.values[r]}},x=(e,t)=>{if(t){let r=I(e,t.floors.data.values,t.floors.data.schema);if(r)return t.floors.data.values[r]}},P=e=>e.adUnits.flatMap(e=>e.bids).map(f).filter(e=>void 0!==e)[0],N=e=>{let t=i.A.getGlobalFloorsConfig();if(!(null==t?void 0:t.floors))throw Error("Global floors config not available");let r=t.floors,{auctionDelay:o,endpoint:n,data:a}=r,l={floors:u(c({},g(r,["auctionDelay","endpoint","data"])),{data:e})};i.A.setToPubx(s.I.NEXTFLOORS_CONFIG,l)},T=(e,t)=>{let r=t.getConfig("floors");if(!r)throw Error("Floors config not available in prebid namespace");let{auctionDelay:o,endpoint:n,data:a}=r,l={floors:u(c({},g(r,["auctionDelay","endpoint","data"])),{data:e})};i.A.setToPubx(s.I.NEXTFLOORS_CONFIG,l)},C=e=>{let t={floorProvider:n.Kq.PUBX,modelVersion:e.modelVersion,currency:e.currency,schema:{fields:e.schema},values:e.defaultValues||{"*|banner":.01}};return e.isTimeoutSegregated&&(t.skipRate=100,t.floorProvider=n.Kq.PUBX_TIMEOUT),t},F=(e,t)=>{if(e.includes("_fm_")){let t=parseFloat(e.split("_fm_")[1].split("_")[0]);if(isNaN(t))throw Error(`Invalid floor multiplier in model version: ${e}`);return t}if(void 0===t.pmacFloorMultiplier||null===t.pmacFloorMultiplier)throw Error(l.rZ[l.O4.PMAC_FLOOR_MULTIPLIER_NOT_FOUND_CONFIG].message);return t.pmacFloorMultiplier},U=(e,t)=>e.includes("_dr_")?-1*parseFloat(e.split("_dr_")[1].split("_")[0]):null!==t.decayRate?-1*t.decayRate:(o.x.warn("No decay rate in floor model version or config",e),null),D=e=>{let t=i.A.getFromPubx(s.I.PUBX_LOADED);return e.bids.map(e=>(0,d.jK)(e,t)).filter(e=>void 0!==e)[0]}},512(e,t,r){r.r(t),r.d(t,{compareCodeAndSlot:()=>a,getGptSlotAdUnit:()=>c,getGptSlotForAdUnitCode:()=>l,getGptSlotInfoForAdUnitCode:()=>d,getGptSlotsWithAdUnitCodes:()=>u,isGptPubadsDefined:()=>n,isSlotMatchingAdUnitCode:()=>s});var o=r(670),i=r(733);function n(){return!!window.googletag&&"function"==typeof window.googletag.pubads&&"function"==typeof window.googletag.pubads().getSlots}let a=(e,t)=>e.getAdUnitPath()===t||e.getSlotElementId()===t;function s(e){return t=>a(t,e)}function l(e){let t;return n()&&(t=window.googletag.pubads().getSlots().find(s(e))),t}function d(e){try{let t=l(e);if(t)return{gptSlot:t.getAdUnitPath(),divId:t.getSlotElementId()};return{}}catch(e){return i.Vy.logScriptError({code:o.O4.UNCAUGHT_ERROR,severity:o.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}}),{}}}let c=e=>{var t;if(!(null==(t=googletag)?void 0:t.pubads)||"function"!=typeof googletag.pubads)return null;try{return googletag.pubads().getSlots().find(t=>t.getAdUnitPath()===e||t.getSlotElementId()===e)||null}catch(e){return i.Vy.logScriptError({code:o.O4.UNCAUGHT_ERROR,severity:o.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}}),null}},u=e=>{try{let t=googletag.pubads().getSlots(),r=[];return e.forEach(e=>{let o=t.find(t=>t.getAdUnitPath()===e||t.getSlotElementId()===e);void 0!==o&&r.push({adUnitCode:e,slot:o})}),r}catch(e){return i.Vy.logScriptError({code:o.O4.UNCAUGHT_ERROR,severity:o.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}}),[]}}},581(e,t,r){r.d(t,{Vn:()=>i,Sp:()=>o});var o={};r.r(o),r.d(o,{getStorageItem:()=>a,removeStorageItem:()=>l,setStorageItem:()=>s}),r(396),r(685),r(817);var i=r(512),n=r(733);let a=(e,t)=>{try{let r=localStorage.getItem(e);return r?JSON.parse(r):t}catch(r){return n.xI.error(`Error getting item [${e}] from localStorage:`,r),t}},s=(e,t)=>{try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(t){return n.xI.error(`Error setting item [${e}] in localStorage:`,t),!1}},l=e=>{try{return localStorage.setItem(e,""),localStorage.removeItem(e),!0}catch(t){return n.xI.error(`Error removing item [${e}] from localStorage:`,t),!1}}},685(e,t,r){r.d(t,{Aj:()=>T,GT:()=>E,PM:()=>N,Qe:()=>b,fI:()=>m,hU:()=>f,jK:()=>C,oo:()=>x,qG:()=>A,rz:()=>O,sZ:()=>I,um:()=>y,yN:()=>S});var o=r(522),i=r(946),n=r(944),a=r(288),s=r(991),l=r(998),d=r(512),c=r(670),u=r(396),g=r(713);function p(e,t,r,o,i,n,a){try{var s=e[n](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(o,i)}let f="pubxai",b=e=>(window[e]=window[e]||{},window[e].que=window[e].que||[],window[e].name=e,window[e]),_=(e,t)=>e.bidder,h=(e,t)=>{let r=e.bidRequestsCount||0,o=Object.keys(a.e7);for(let e of o){let t=a.e7[e];if(r>=t[0]&&r<=t[1])return e}return o[o.length-1]},O=(e,t)=>{var r,o;return(null==(o=e.ortb2Imp)||null==(r=o.ext)?void 0:r.gpid)||null},E=e=>{let t,r={floors:{auctionDelay:e.auctionDelay,endpoint:{url:e.floorFetchUrl},data:(t={floorProvider:s.Kq.PUBX,modelVersion:e.modelVersion,currency:e.currency,schema:{fields:e.schema},values:e.defaultValues||{"*|banner":.01}},e.isTimeoutSegregated&&(t.skipRate=100,t.floorProvider=s.Kq.PUBX_TIMEOUT),t)}};if(e.floorMin&&(r.floors.floorMin=e.floorMin),e.floorEnforcement){let t="string"==typeof e.floorEnforcement?JSON.parse(e.floorEnforcement):e.floorEnforcement;r.floors.enforcement=t}return r.floors.additionalSchemaFields={bidder:_,rank:h,gpid:O},r},R=(e,t,r,o,n)=>{try{if(void 0===e||"string"!=typeof t||"string"!=typeof r)throw Error(c.O4.CURRENCY_INVALID_INPUT);if(void 0===o.pbNamespace.convertCurrency)throw Error(c.O4.CURRENCY_MODULE_NOT_INSTALLED);if(t===r)return Number(e);return o.pbNamespace.convertCurrency(e,t,r)}catch(o){return i.V.logScriptError({code:c.O4.CURRENCY_INVALID_INPUT,severity:c.MU.ERROR,adUnitCode:n,payload:{error:o instanceof Error?o.message:String(o),value:e,fromCurrency:t,toCurrency:r}}),Number(e)}},m=()=>{var e;return(e=function*(){},function(){var t=this,r=arguments;return new Promise(function(o,i){var n=e.apply(t,r);function a(e){p(n,o,i,a,s,"next",e)}function s(e){p(n,o,i,a,s,"throw",e)}a(void 0)})})()},y=(e,t,r,o)=>{let i=e;return o&&(i=o(i,t)),i.adUnits=i.adUnits.filter(e=>r(e)),i},A=e=>{let t=void 0!==e.mediaTypes.banner,r=e.bids.some(e=>!!e.bidder),o=(0,l.arePubxFloorsSet)(e),i=n.A.isPubxLoaded();if(!i&&o)throw Error("Pubx-off floors found for adUnitCode "+e.code);return t&&r&&(!i&&!o||i&&o)},v=(e,t)=>void 0!==e.adserverTargeting&&void 0!==e.adserverTargeting[t]&&!isNaN(e.adserverTargeting[t])&&parseFloat(e.adserverTargeting[t])>0,I=(e,t,r)=>{var s,p,f,b,_;let h,O,E,m,y,A,I,S,x,{adUnitBidsReceived:P,adUnitBidsRejected:N,adUnitBidsFromBidderRequests:T}=(h=t.auctionId,O=t.bidsReceived,E=e.code,m=O.filter(e=>e.adUnitCode===E),A=(y=t.bidsRejected)?y.filter(e=>!!e.originalCpm):[],I=e.code,{auctionId:h,adUnitBidsReceived:m,adUnitBidsRejected:A.filter(e=>e.adUnitCode===I),adUnitBidsFromBidderRequests:(S=t.bidderRequests,x=e.code,S.flatMap(e=>e.bids).filter(e=>e.adUnitCode===x))}),C=t.auctionId,F=(_=r.hbPbKey,0===P.length&&0===N.length?a.Av.NOBIDS:P.some(e=>v(e,_))?a.Av.WIN:a.Av.FLOORED),U=null==(p=T[0])||null==(s=p.floorData)?void 0:s.floorProvider,D=null==(b=T[0])||null==(f=b.floorData)?void 0:f.modelVersion,L=(0,l.arePubxFloorsSkipped)(e),{bidCpmValue:w,originalBidCpmValue:M,bidCurrency:B,floorData:V,adserverTargeting:G}=((e,t,r,s,p,f,b)=>{let{hbPbKey:_}=f,h,O,E,m,y={};switch(p){case a.Av.WIN:{let e=t.filter(e=>v(e,_)).sort((e,t)=>parseFloat(t.adserverTargeting[_])-parseFloat(e.adserverTargeting[_]))[0];h=parseFloat(e.adserverTargeting[_]),E=e.currency,m=e.floorData,y=e.adserverTargeting;break}case a.Av.FLOORED:{let o=[...r,...t].sort((t,r)=>R(r.originalCpm,r.originalCurrency,f.currency,f,e.code)-R(t.originalCpm,t.originalCurrency,f.currency,f,e.code))[0];h=o.originalCpm,E=o.originalCurrency,m=o.floorData,y=o.adserverTargeting||{};break}case a.Av.NOBIDS:{let t,r=n.A.getGlobalFloorsConfig();if(E=r?r.floors.data.currency:f.currency,(0,l.arePubxFloorsSkipped)(e)){h=.01;break}let a=(0,d.getGptSlotAdUnit)(e.code);if(t=a?(0,l.getFloorRuleValue)(a,n.A.getFromPubx(g.I.NEXTFLOORS_CONFIG))||(0,l.getFloorRuleValue)(a,n.A.getGlobalFloorsConfig()):(0,l.getFloorRuleValueByAdUnitCode)(e.code,n.A.getFromPubx(g.I.NEXTFLOORS_CONFIG))||(0,l.getFloorRuleValueByAdUnitCode)(e.code,n.A.getGlobalFloorsConfig())){h=t;break}o.x.warn("NOBID floor rule not found for adUnit",e.code);let u=s.map(e=>{var t;if("function"!=typeof e.getFloor)return;let r=null==(t=e.getFloor({size:"*",mediaType:"banner"}))?void 0:t.floor;return"number"==typeof r&&r>=0?r:void 0}).filter(e=>void 0!==e);if(u.length>0){h=u.reduce((e,t)=>e+t,0)/u.length;break}o.x.warn("NOBID getFloor() not found for adUnit",e.code),f.defaultValues&&void 0!==f.defaultValues["*|banner"]?h=f.defaultValues["*|banner"]:(i.V.logScriptError({code:c.O4.NO_BID_FLOOR_RULE_NOT_FOUND,severity:c.MU.WARNING,adUnitCode:e.code,payload:{error:c.rZ[c.O4.NO_BID_FLOOR_RULE_NOT_FOUND].message}}),h=.01)}}return i.V.logAuctionEvent({type:"pbBid",data:{adUnitCode:e.code,status:p,bidCurrency:E,bidValue:parseFloat(h.toFixed(u.b2)),pubCurrency:f.currency,floorData:(0,l.formatFloorData)(m),adserverTargeting:y}},b),O=h,p===a.Av.FLOORED&&(h=R(h,E,f.currency,f,e.code)),{bidCpmValue:parseFloat(h.toFixed(u.b2)),originalBidCpmValue:parseFloat(O.toFixed(u.b2)),bidCurrency:E,floorData:(0,l.formatFloorData)(m),adserverTargeting:y}})(e,P,N,T,F,r,t);return{auctionId:C,adUnit:e,adUnitStatus:F,bidCpmValue:w,originalBidCpmValue:M,bidCurrency:B,adserverTargeting:G,floorData:V,floorProvider:U,floorSkipStatus:L,floorModelVersion:D}},S=(e,t)=>{if(!e||!e.getEvents)throw Error(c.O4.INVALID_PREBID_NAMESPACE);return e.getEvents().filter(e=>e.eventType===a.gl.AUCTION_END).findIndex(e=>e.args.auctionId===t)},x=e=>{if(!e||!e.getConfig)throw Error(c.O4.INVALID_PREBID_NAMESPACE);let t=e.getConfig("floors");return t&&t.data&&t.data.floorProvider?t.data.floorProvider:void 0},P=(e,t)=>{if(e.includes(t))try{let r=e.split(t)[1].split("_");if(0===r.length)return;let o=parseFloat(r[0]);return isNaN(o)?void 0:o}catch(e){return}},N=(e,t,r)=>{let{bidCpmValue:i,adUnitStatus:n,adUnit:s}=e;o.x.log("cpm values:",s.code,i);let d=parseFloat((i*((e,t,r)=>{switch(r){case a.Av.WIN:return P(e,"_dwt_")||t.winBidMultiplier;case a.Av.FLOORED:return P(e,"_dt_")||t.flooredBidMultiplier;case a.Av.NOBIDS:return P(e,"_dnt_")||t.noBidMultiplier}})(t,r,n)).toFixed(u.b2));return(0,l.arePubxFloorsSkipped)(s)?void 0:{adUnitCode:s.code,floorValue:d,status:n}},T=(e,t)=>{e.que.push(function(){Array.isArray(e.installedModules)&&e.installedModules.includes("pubxaiAnalyticsAdapter")?(e.enableAnalytics(t),o.x.info("Enabling Analytics",t)):i.V.logScriptError({code:c.O4.PUBX_AA_NOT_FOUND,severity:c.MU.FATAL,payload:{error:c.rZ[c.O4.PUBX_AA_NOT_FOUND].message}})})},C=(e,t)=>{let{floorData:r}=e;if(r&&(r.floorProvider===s.Kq.PUBX||!t))return r.fetchStatus}},817(e,t,r){r.d(t,{R0:()=>n,X5:()=>i,ZI:()=>o});let o=()=>{try{if(/ipad|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase()))return 2;if(/iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(navigator.userAgent.toLowerCase()))return 1;return 0}catch(e){return 0}},i=()=>{try{if(/Edg/.test(navigator.userAgent))return 3;if(/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))return 0;if(navigator.userAgent.match("CriOS"))return 0;else if(/Firefox/.test(navigator.userAgent))return 1;else if(/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor))return 2;else if(/Trident/.test(navigator.userAgent)||/MSIE/.test(navigator.userAgent))return 4;else return 5}catch(e){return 5}},n=()=>{try{if(-1!=navigator.userAgent.indexOf("Android"))return 5;if(-1!=navigator.userAgent.indexOf("like Mac"))return 4;if(-1!=navigator.userAgent.indexOf("Win"))return 0;if(-1!=navigator.userAgent.indexOf("Mac"))return 1;if(-1!=navigator.userAgent.indexOf("Linux"))return 2;if(-1!=navigator.appVersion.indexOf("X11"))return 3;return 6}catch(e){return 6}}},396(e,t,r){r.d(t,{PB:()=>c,Qg:()=>g,b2:()=>n,c$:()=>a,cv:()=>p,kK:()=>s,lk:()=>u,to:()=>f});var o=r(944),i=r(522);let n=4;function a(e){var t;return(e.protocol||"http")+"://"+(e.host||e.hostname+(e.port?`:${e.port}`:""))+(e.pathname||"")+(e.search?`?${Object.keys(t=e.search||{}).map(e=>Array.isArray(t[e])?t[e].map(t=>`${e}[]=${t}`).join("&"):`${e}=${t[e]}`).join("&")}`:"")+(e.hash?`#${e.hash}`:"")}function s(e){try{var t;return(t=e,"string"==typeof t?t.split(/\s*,\s*/).map(e=>e.match(/^(\d+)x(\d+)$/i)).filter(e=>null!==e).map(([e,t,r])=>[parseInt(t,10),parseInt(r,10)]):Array.isArray(t)?d(t)?t.filter(d):[t]:[]).map(l)}catch(e){return i.x.error("parseSizesInput error:",e),[]}}function l(e){return e[0]+"x"+e[1]}function d(e){return Array.isArray(e)&&2===e.length&&!isNaN(e[0])&&!isNaN(e[1])}function c(e,t=0){let r=function(e,t){if("function"==typeof Math.imul)return Math.imul(e,t);var r=(4194303&e)*(t|=0);return 0xffc00000&e&&(r+=(0xffc00000&e)*t|0),0|r},o=0xdeadbeef^t,i=0x41c6ce57^t;for(let t=0,n;t<e.length;t++)o=r(o^(n=e.charCodeAt(t)),0x9e3779b1),i=r(i^n,0x5f356495);return o=r(o^o>>>16,0x85ebca6b)^r(i^i>>>13,0xc2b2ae35),(0x100000000*(2097151&(i=r(i^i>>>16,0x85ebca6b)^r(o^o>>>13,0xc2b2ae35)))+(o>>>0)).toString()}let u=()=>{let e=new Date().getTime(),t="u">typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let o=16*Math.random();return e>0?(o=(e+o)%16|0,e=Math.floor(e/16)):(o=(t+o)%16|0,t=Math.floor(t/16)),("x"===r?o:3&o|8).toString(16)})},g=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),p=e=>{var t,r,o,i;return{pageId:e,userAgent:null==(t=navigator)?void 0:t.userAgent,host:null==(r=window.location)?void 0:r.host,path:null==(o=window.location)?void 0:o.pathname,doNotTrack:null==(i=navigator)?void 0:i.doNotTrack}},f=e=>({variant:o.A.getFromPubx("variant"),version:o.A.getFromPubx("version"),loadTime:o.A.getLoadTime(),pbVersion:e.pbNamespace.version,pbNamespace:e.pbNamespace.name})}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.rv=()=>"1.7.1",r.ruid="bundler=rspack@1.7.1",(()=>{var e,t=r(309),o=r(991),i=((e={}).NONE="none",e.CUSTOM_MAGNITE="customMagnite",e);function n(e,t,r,o,i,n,a){try{var s=e[n](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(o,i)}class a{static createBillingManager(e){var t;return(t=function*(){if("none"===i.CUSTOM_MAGNITE){let{CustomMagniteBilling:t}=yield Promise.resolve().then(r.bind(r,436));return new t(e)}let{NullBilling:t}=yield Promise.resolve().then(r.bind(r,151));return new t(e)},function(){var e=this,r=arguments;return new Promise(function(o,i){var a=t.apply(e,r);function s(e){n(a,o,i,s,l,"next",e)}function l(e){n(a,o,i,s,l,"throw",e)}s(void 0)})})()}}var s=r(288),l=r(685),d=r(670);function c(e,t,r,o,i,n,a){try{var s=e[n](a),l=s.value}catch(e){r(e);return}s.done?t(l):Promise.resolve(l).then(o,i)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(o,i){var n=e.apply(t,r);function a(e){c(n,o,i,a,s,"next",e)}function s(e){c(n,o,i,a,s,"throw",e)}a(void 0)})}}function g(e,o,i){return u(function*(){try{var n,s,c,g,p;t.fN.updatePubxLoadedFromAuctionData(i);let d=yield(0,l.fI)(),f=(0,l.um)(i,e,l.qG,d);n=new t.YJ(e,f).generateAuctionKeyValues(),(s=f).adUnits.forEach(e=>{let r=n[e.code];r?t.gb.getAll().forEach(t=>{t.setKeyValues(e.code,r,s)}):t.xI.warn("No key-values found for adUnit:",e.code)}),(yield a.createBillingManager(e)).processBillingForAuction(f),yield(c=e,g=o,p=f,u(function*(){let{Pmac:e}=yield Promise.resolve().then(r.bind(r,684)),t=new e(c,g,p);yield t.triggerPmac()})())}catch(e){t.Vy.logScriptError({code:d.O4.UNCAUGHT_ERROR,severity:d.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}})()}u(function*(){try{if(window.__pubxInitialized__)return;window.__pubxInitialized__=!0,t.xI.init(),t.mf.initConfig();let e=t.mf.getPrebidGamConfigs();for(let r of(t.xI.info("Pubx initialized with configs :",e),e)){try{t.fN.init(r),s.QG.init(r.pbNamespace),t.Vy.init(r),t.YT.init(r)}catch(e){t.xI.error("Failed to initialize core modules:",e)}new t.j0(r).init();let e=yield o.k6.createFloorManager(r);e.init(),yield function(e){return u(function*(){for(let r of["gam"])try{t.gb.has(r,e.pbNamespaceKey)||(yield t.gb.register(e,r))}catch(e){t.Vy.logScriptError({code:d.O4.UNCAUGHT_ERROR,severity:d.MU.ERROR,payload:{error:e instanceof Error?e.message:String(e)}})}})()}(r),s.QG.on(s.gl.AUCTION_END,g.bind(null,r,e))}}catch(e){t.xI.error("Failed to initialize Pubx:",e)}})()})()})();